# 第二阶段实现计划（不含 AI 功能）

> 本文基于 `README.md`、`DEVELOP/PHASE1_IMPLEMENTATION_PLAN.md`、`DEVELOP/TODO.md`、`DOC/usage.md`、`DOC/arch.md` 整理第二阶段应完善和实现的功能，明确排除 AI 相关能力。

## 1. 阶段目标

- 在第一阶段 MVP 的基础上，补齐社区可持续运营所需的核心互动、治理与个人体验能力。
- 优先实现文档中已明确为“第二阶段”的功能项，以及第一阶段已预留但未开放的能力。
- AI 相关能力（重复帖检测、审核辅助、摘要）继续保持在后续版本，不纳入本阶段。

## 2. 第二阶段功能清单（非 AI）

### 2.1 回复能力增强
- 二级回复（楼中楼）：开放 `parent_reply_id` 能力，支持对指定楼层回复。
- 引用回复：在回复中携带被引用楼层信息，保留上下文。

### 2.2 互动能力
- 点赞：帖子点赞、回复点赞。
- 收藏：支持用户收藏帖子并在个人中心查看。
- 分享：提供帖子分享入口与基础分享数据结构。

### 2.3 通知与提醒
- @用户提醒：当用户被提及时生成通知。
- 消息通知中心：支持 `@我`、`回复我`、系统通知分类展示与已读管理。
- 落地通知数据模型（`notifications`）与基础查询接口。

### 2.4 吧与社区治理能力
- 加入/退出吧：用户可主动加入或退出吧，沉淀“我的吧”数据。
- 吧资料编辑：吧主/版主可编辑吧描述、吧规、头像等基础资料。
- 吧务角色管理：基于 `bar_members` 支持 owner/moderator/member 的管理操作。

### 2.5 个人中心
- 我的帖子：查看自己发布的帖子列表。
- 我的回复：查看自己发布的回复列表。
- 我的收藏：查看已收藏帖子。
- 我的吧：查看已加入吧列表。

### 2.6 搜索能力
- 全局搜索：新增 `GET /api/search?q=&type=`，支持吧/帖子/用户基础检索。
- 第一版采用 SQL LIKE 实现，后续可平滑升级全文检索。

### 2.7 内容表达与媒体能力
- Markdown 内容渲染：帖子与回复支持 `content_type=markdown` 渲染。
- 媒体上传：接入 S3/MinIO 预签名上传链路，支持图片/视频内容引用。

### 2.8 平台工程与安全基线
- 接口限流基线：登录按 IP + email 限流，发帖/回帖按 user_id 限流。
- 本地一键启动编排完善：维护并固化 postgres/backend/frontend 开发编排。

## 3. 阶段边界（本阶段不做）

- 不实现任何 AI 相关功能：重复帖检测、AI 审核提示、长帖摘要。
- 不实现重度创作工具与复杂推荐系统。

## 4. 验收基线（建议）

- 第二阶段功能清单中的每个模块均具备对应 API 与前端页面/入口。
- 所有新增写接口具备权限校验与参数校验。
- 通知、搜索、吧务角色、楼中楼至少覆盖一条端到端主链路测试。
